<div class="table-container">
  <div class="table-header">
    <h3 class="table-title">Danh s√°ch ƒë∆°n/Sale</h3>
    
    <div class="search-box">
      <input
        type="text"
        class="search-input"
        placeholder="T√¨m ki·∫øm kh√°ch h√†ng, s·∫£n ph·∫©m..."
        [value]="searchQuery()"
        (input)="searchQuery.set($any($event.target).value)"
        (keyup.enter)="onSearch()"
      />
      <button class="search-btn" (click)="onSearch()">
        üîç
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && salesData.length === 0" class="empty-state">
    <div class="empty-icon">üì≠</div>
    <p class="empty-message">Kh√¥ng c√≥ d·ªØ li·ªáu</p>
  </div>

  <!-- Data Table -->
  <div *ngIf="!loading && salesData.length > 0" class="table-wrapper">
    <table mat-table [dataSource]="salesData" class="sales-table">
      <!-- Customer Name Column -->
      <ng-container matColumnDef="customerName">
        <th mat-header-cell *matHeaderCellDef>{{ columnHeaders['customerName'] }}</th>
        <td mat-cell *matCellDef="let order">
          <span *ngIf="!isEditing(order.id)">{{ order.customerName }}</span>
          <input
            *ngIf="isEditing(order.id)"
            type="text"
            class="edit-input"
            [(ngModel)]="editForm.customerName"
            placeholder="T√™n kh√°ch h√†ng"
          />
        </td>
      </ng-container>

      <!-- Phone Column -->
      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef>{{ columnHeaders['phone'] }}</th>
        <td mat-cell *matCellDef="let order">
          <span *ngIf="!isEditing(order.id)">{{ order.phone }}</span>
          <input
            *ngIf="isEditing(order.id)"
            type="text"
            class="edit-input"
            [(ngModel)]="editForm.phone"
            placeholder="S·ªë ƒëi·ªán tho·∫°i"
          />
        </td>
      </ng-container>

      <!-- Product Name Column -->
      <ng-container matColumnDef="productName">
        <th mat-header-cell *matHeaderCellDef>{{ columnHeaders['productName'] }}</th>
        <td mat-cell *matCellDef="let order">{{ order.productName }}</td>
      </ng-container>

      <!-- Quantity Column -->
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef>{{ columnHeaders['quantity'] }}</th>
        <td mat-cell *matCellDef="let order">{{ order.quantity }}</td>
      </ng-container>

      <!-- Unit Price Column -->
      <ng-container matColumnDef="unitPrice">
        <th mat-header-cell *matHeaderCellDef>{{ columnHeaders['unitPrice'] }}</th>
        <td mat-cell *matCellDef="let order">{{ formatCurrency(order.unitPrice) }}</td>
      </ng-container>

      <!-- Total Price Column -->
      <ng-container matColumnDef="totalPrice">
        <th mat-header-cell *matHeaderCellDef>{{ columnHeaders['totalPrice'] }}</th>
        <td mat-cell *matCellDef="let order" class="total-price">
          {{ formatCurrency(order.totalPrice) }}
        </td>
      </ng-container>

      <!-- Created Date Column -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>{{ columnHeaders['createdAt'] }}</th>
        <td mat-cell *matCellDef="let order">{{ formatDate(order.createdAt) }}</td>
      </ng-container>

      <!-- Note Status Column -->
      <ng-container matColumnDef="noteStatus">
        <th mat-header-cell *matHeaderCellDef>{{ columnHeaders['noteStatus'] }}</th>
        <td mat-cell *matCellDef="let order">
          <mat-select
            *ngIf="!isEditing(order.id)"
            class="status-select"
            [ngClass]="getStatusBadgeClass(order.noteStatus)"
            [value]="order.noteStatus"
            (selectionChange)="onStatusChange(order.id, $event.value)"
            [style.color]="getStatusColor(order.noteStatus)"
          >
            <mat-option *ngFor="let status of statusOptions" [value]="status.value">
              <span [style.color]="status.color">{{ status.label }}</span>
            </mat-option>
          </mat-select>
          
          <mat-select
            *ngIf="isEditing(order.id)"
            class="status-select edit-select"
            [(ngModel)]="editForm.saleStatus"
          >
            <mat-option *ngFor="let status of statusOptions" [value]="status.apiValue">
              <span [style.color]="status.color">{{ status.label }}</span>
            </mat-option>
          </mat-select>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>{{ columnHeaders['actions'] }}</th>
        <td mat-cell *matCellDef="let order" class="actions-cell">
          <div class="action-buttons">
            <!-- View Mode Buttons -->
            <button
              *ngIf="!isEditing(order.id)"
              mat-icon-button
              color="primary"
              (click)="startEdit(order)"
              [disabled]="editingRowId !== null"
              matTooltip="Ch·ªânh s·ª≠a"
            >
              <mat-icon>edit</mat-icon>
            </button>

            <!-- Edit Mode Buttons -->
            <ng-container *ngIf="isEditing(order.id)">
              <button
                mat-icon-button
                color="primary"
                (click)="saveEdit(order)"
                [disabled]="isSaving(order.id)"
                matTooltip="L∆∞u"
              >
                <mat-spinner *ngIf="isSaving(order.id)" diameter="20"></mat-spinner>
                <mat-icon *ngIf="!isSaving(order.id)">save</mat-icon>
              </button>
              
              <button
                mat-icon-button
                color="warn"
                (click)="cancelEdit()"
                [disabled]="isSaving(order.id)"
                matTooltip="H·ªßy"
              >
                <mat-icon>cancel</mat-icon>
              </button>
            </ng-container>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <!-- Table Footer with Total -->
    <div class="table-footer">
      <div class="footer-left">
        <span class="footer-label">T·ªïng ti·ªÅn:</span>
        <span class="footer-value">{{ formatCurrency(getTotalAmount()) }}</span>
      </div>
    </div>

    <!-- Paginator -->
    <mat-paginator
      [length]="totalRecords"
      [pageSize]="25"
      [pageSizeOptions]="pageSizeOptions"
      [showFirstLastButtons]="true"
      (page)="onPageChange($event)"
    >
    </mat-paginator>
  </div>
</div>
