<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <h1>B·∫£ng ƒêi·ªÅu Khi·ªÉn B√°n H√†ng</h1>
    <p class="subtitle">Theo d√µi v√† ph√¢n t√≠ch d·ªØ li·ªáu b√°n h√†ng</p>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error()" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <p class="error-message">{{ error() }}</p>
    <button class="btn btn-primary" (click)="retryLoad()">Th·ª≠ l·∫°i</button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading() && !error()" class="dashboard-content">
    <!-- KPI Summary Cards -->
    <section class="kpi-section">
      <div class="kpi-grid">
        <div class="kpi-card kpi-card-blue">
          <div class="kpi-header">
            <span class="kpi-label">T·ªïng S·ªë B·∫£n Ghi</span>
            <span class="trend-indicator">{{ getTrendIndicator(0) }}</span>
          </div>
          <div class="kpi-value">{{ kpiMetrics().totalRecords | number }}</div>
        </div>

        <div class="kpi-card kpi-card-success">
          <div class="kpi-header">
            <span class="kpi-label">Th√†nh C√¥ng</span>
            <span class="trend-indicator">{{ getTrendIndicator(1) }}</span>
          </div>
          <div class="kpi-value">{{ kpiMetrics().successCount | number }}</div>
        </div>

        <div class="kpi-card kpi-card-failed">
          <div class="kpi-header">
            <span class="kpi-label">Th·∫•t B·∫°i</span>
            <span class="trend-indicator">{{ getTrendIndicator(-1) }}</span>
          </div>
          <div class="kpi-value">{{ kpiMetrics().failedCount | number }}</div>
        </div>

        <div class="kpi-card kpi-card-duplicate">
          <div class="kpi-header">
            <span class="kpi-label">Tr√πng L·∫∑p</span>
            <span class="trend-indicator">{{ getTrendIndicator(0) }}</span>
          </div>
          <div class="kpi-value">{{ kpiMetrics().duplicateCount | number }}</div>
        </div>

        <div class="kpi-card kpi-card-pending">
          <div class="kpi-header">
            <span class="kpi-label">ƒêang Ch·ªù</span>
            <span class="trend-indicator">{{ getTrendIndicator(0) }}</span>
          </div>
          <div class="kpi-value">{{ kpiMetrics().pendingCount | number }}</div>
        </div>

        <div class="kpi-card kpi-card-amount">
          <div class="kpi-header">
            <span class="kpi-label">T·ªïng Doanh Thu</span>
            <span class="trend-indicator">{{ getTrendIndicator(1) }}</span>
          </div>
          <div class="kpi-value">{{ formatCurrency(kpiMetrics().totalAmount) }}</div>
        </div>
      </div>
    </section>

    <!-- Analytics Charts -->
    <section class="analytics-section">
      <div class="analytics-grid">
        <!-- Status Distribution Chart -->
        <div class="chart-card">
          <h3 class="chart-title">Ph√¢n B·ªë Tr·∫°ng Th√°i</h3>
          <div class="status-chart">
            <div *ngFor="let item of statusDistribution()" class="status-bar-wrapper">
              <div class="status-info">
                <span class="status-label">{{ getStatusLabel(item.status) }}</span>
                <span class="status-count">{{ item.count }}</span>
              </div>
              <div class="status-bar-container">
                <div 
                  class="status-bar" 
                  [style.width.%]="getPercentage(item.count, kpiMetrics().totalRecords)"
                  [style.background-color]="item.color">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Over Time -->
        <div class="chart-card">
          <h3 class="chart-title">Hi·ªáu Su·∫•t 7 Ng√†y Qua</h3>
          <div class="performance-chart">
            <div class="chart-legend">
              <div class="legend-item">
                <span class="legend-color legend-success"></span>
                <span>Th√†nh c√¥ng</span>
              </div>
              <div class="legend-item">
                <span class="legend-color legend-failed"></span>
                <span>Th·∫•t b·∫°i</span>
              </div>
            </div>
            <div class="line-chart">
              <div *ngFor="let data of performanceData()" class="chart-day">
                <div class="chart-bars">
                  <div 
                    class="chart-bar chart-bar-success" 
                    [style.height.px]="data.successCount * 3"
                    [title]="'Th√†nh c√¥ng: ' + data.successCount">
                  </div>
                  <div 
                    class="chart-bar chart-bar-failed" 
                    [style.height.px]="data.failedCount * 3"
                    [title]="'Th·∫•t b·∫°i: ' + data.failedCount">
                  </div>
                </div>
                <div class="chart-label">{{ formatDate(data.date) }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Top Performers -->
        <div class="chart-card">
          <h3 class="chart-title">Top 5 Nh√¢n Vi√™n B√°n H√†ng</h3>
          <div class="top-performers">
            <div *ngFor="let performer of topPerformers()" class="performer-row">
              <div class="performer-rank">
                <span class="rank-badge" [class.rank-1]="performer.rank === 1">
                  #{{ performer.rank }}
                </span>
              </div>
              <div class="performer-info">
                <div class="performer-name">{{ performer.name }}</div>
                <div class="performer-stats">
                  {{ performer.transactionCount }} giao d·ªãch
                </div>
              </div>
              <div class="performer-amount">
                {{ formatCurrency(performer.totalAmount) }}
              </div>
            </div>
            <div *ngIf="topPerformers().length === 0" class="no-data">
              Kh√¥ng c√≥ d·ªØ li·ªáu
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Filters Section -->
    <section class="filters-section">
      <div class="filters-card">
        <h3 class="filters-title">B·ªô L·ªçc</h3>
        <div class="filters-grid">
          <div class="filter-group">
            <label for="statusFilter" class="filter-label">Tr·∫°ng th√°i</label>
            <select 
              id="statusFilter" 
              class="filter-select" 
              [(ngModel)]="selectedStatus"
              (ngModelChange)="selectedStatus.set($event)">
              <option *ngFor="let option of statusOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>

          <div class="filter-group">
            <label for="fromDate" class="filter-label">T·ª´ ng√†y</label>
            <input 
              type="date" 
              id="fromDate" 
              class="filter-input" 
              [(ngModel)]="fromDate"
              (ngModelChange)="fromDate.set($event)">
          </div>

          <div class="filter-group">
            <label for="toDate" class="filter-label">ƒê·∫øn ng√†y</label>
            <input 
              type="date" 
              id="toDate" 
              class="filter-input" 
              [(ngModel)]="toDate"
              (ngModelChange)="toDate.set($event)">
          </div>

          <div class="filter-actions">
            <button class="btn btn-primary" (click)="applyFilters()">
              √Åp d·ª•ng
            </button>
            <button class="btn btn-secondary" (click)="clearFilters()">
              X√≥a b·ªô l·ªçc
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Data Table -->
    <section class="table-section">
      <div class="table-card">
        <div class="table-header">
          <h3 class="table-title">D·ªØ Li·ªáu B√°n H√†ng</h3>
          <div class="table-controls">
            <label for="pageSize" class="page-size-label">Hi·ªÉn th·ªã:</label>
            <select 
              id="pageSize" 
              class="page-size-select" 
              [(ngModel)]="pageSize"
              (ngModelChange)="pageSize.set($event); onPageSizeChange()">
              <option *ngFor="let size of pageSizeOptions" [value]="size">
                {{ size }}
              </option>
            </select>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="isEmpty()" class="empty-state">
          <div class="empty-icon">üì≠</div>
          <p class="empty-message">Kh√¥ng c√≥ d·ªØ li·ªáu</p>
          <button class="btn btn-secondary" (click)="clearFilters()">
            X√≥a b·ªô l·ªçc
          </button>
        </div>

        <!-- Data Table -->
        <div *ngIf="!isEmpty()" class="table-wrapper">
          <table class="data-table">
            <thead class="table-head">
              <tr>
                <th *ngFor="let column of tableColumns()">
                  {{ column }}
                </th>
              </tr>
            </thead>
            <tbody class="table-body">
              <tr *ngFor="let row of salesData()" class="table-row">
                <td *ngFor="let column of tableColumns()">
                  <span *ngIf="column === 'status'" 
                        [class]="'badge ' + getStatusClass(row[column])">
                    {{ getStatusLabel(row[column]) }}
                  </span>
                  <span *ngIf="column === 'amount'">
                    {{ formatCurrency(row[column]) }}
                  </span>
                  <span *ngIf="column === 'createdAt'">
                    {{ formatDate(row[column]) }}
                  </span>
                  <span *ngIf="column !== 'status' && column !== 'amount' && column !== 'createdAt'">
                    {{ row[column] }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div *ngIf="!isEmpty()" class="pagination-container">
          <div class="pagination-info">
            Hi·ªÉn th·ªã {{ startRecord() }}-{{ endRecord() }} trong t·ªïng s·ªë {{ totalRecords() | number }} b·∫£n ghi
          </div>
          <div class="pagination-controls">
            <button 
              class="pagination-btn" 
              [disabled]="currentPage() === 0"
              (click)="goToPage(0)">
              ‚ü™
            </button>
            <button 
              class="pagination-btn" 
              [disabled]="currentPage() === 0"
              (click)="goToPage(currentPage() - 1)">
              ‚Äπ
            </button>
            
            <button 
              *ngFor="let page of getPageNumbers()" 
              class="pagination-btn"
              [class.active]="page === currentPage()"
              (click)="goToPage(page)">
              {{ page + 1 }}
            </button>
            
            <button 
              class="pagination-btn" 
              [disabled]="currentPage() === totalPages() - 1"
              (click)="goToPage(currentPage() + 1)">
              ‚Ä∫
            </button>
            <button 
              class="pagination-btn" 
              [disabled]="currentPage() === totalPages() - 1"
              (click)="goToPage(totalPages() - 1)">
              ‚ü´
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
